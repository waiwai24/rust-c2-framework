# Rust C2 Framework

   <img src="web/static/rust-c2.png" alt="rust-c2" width="400"/>

ä¸€ä¸ªä½¿ç”¨Rustç¼–å†™çš„ã€ç»è¿‡é‡æ„çš„å‘½ä»¤ä¸æ§åˆ¶(C2)æ¡†æ¶ï¼Œå…·æœ‰æ¸…æ™°çš„æ¨¡å—åŒ–ç»“æ„ï¼ŒåŒ…å«å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯å’ŒWebç®¡ç†ç•Œé¢ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å¹³å°æ”¯æŒ**: æ”¯æŒLinux
- ğŸ” **å®‰å…¨é€šä¿¡**: ä½¿ç”¨AES-256-GCMåŠ å¯†é€šä¿¡
- ğŸŒ **Webç®¡ç†ç•Œé¢**: ç°ä»£åŒ–çš„Webæ§åˆ¶å°ï¼Œä½¿ç”¨Axumå’ŒAskamaæ„å»º
- ğŸ”„ **å¼‚æ­¥æ¶æ„**: åŸºäºTokioçš„é«˜æ€§èƒ½å¼‚æ­¥æ¶æ„
- ğŸ’» **è¿œç¨‹å‘½ä»¤æ‰§è¡Œ**: å®æ—¶å‘½ä»¤æ‰§è¡Œå’Œç»“æœåé¦ˆ
- ğŸ–¥ï¸ **åå¼¹Shell**: äº¤äº’å¼Shellä¼šè¯
- ğŸ“Š **å®æ—¶ç›‘æ§**: å®¢æˆ·ç«¯çŠ¶æ€å®æ—¶ç›‘æ§
- ğŸ“ **é…ç½®ç®¡ç†**: é€šè¿‡`toml`æ–‡ä»¶è½»æ¾é…ç½®å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯
- ğŸ“¦ **å·¥ä½œåŒºç»“æ„**: ä½¿ç”¨Cargoå·¥ä½œåŒºç®¡ç†å¤šä¸ªcrate

## é¡¹ç›®ç»“æ„

é¡¹ç›®ç°åœ¨æ˜¯ä¸€ä¸ªCargoå·¥ä½œåŒºï¼Œç»“æ„å¦‚ä¸‹ï¼š

```shell
rust-c2-framework/
â”œâ”€â”€ common/               # é€šç”¨åº“ (åè®®, åŠ å¯†, é…ç½®, é”™è¯¯å¤„ç†)
â”‚   â”œâ”€â”€ src/
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ client/               # å®¢æˆ·ç«¯Crate
â”‚   â”œâ”€â”€ src/
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ server/               # æœåŠ¡ç«¯Crate
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ templates/        # Webæ¨¡æ¿
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ web/
â”‚   â””â”€â”€ static/           # é™æ€æ–‡ä»¶ (CSS, JSç­‰)
â””â”€â”€ Cargo.toml            # å·¥ä½œåŒºé…ç½®
```

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®

æœåŠ¡ç«¯ä¼šåœ¨è¿è¡Œæ—¶ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–é…ç½®ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ä¸é‡æ–°ç¼–è¯‘çš„æƒ…å†µä¸‹ä¿®æ”¹è¿™äº›æ–‡ä»¶æ¥æ›´æ”¹é…ç½®ã€‚

**æœåŠ¡ç«¯é…ç½® (`server_config.toml`)**:

åœ¨è¿è¡ŒæœåŠ¡ç«¯äºŒè¿›åˆ¶æ–‡ä»¶çš„ç›¸åŒç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `server_config.toml` çš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼ŒæœåŠ¡ç«¯å°†æ— æ³•å¯åŠ¨å¹¶æŠ¥é”™ã€‚

```toml
host = "0.0.0.0"
port = 8080
encryption_key = "a_very_secret_key_that_is_32_bytes"
client_timeout = 300
max_clients = 1000
log_file = "c2_server.log"
enable_audit = true

[web]
enabled = true
static_dir = "web/static"
template_dir = "server/templates" # æ³¨æ„è·¯å¾„
enable_cors = true
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
# ç¼–è¯‘æ•´ä¸ªå·¥ä½œåŒº
cargo build --release

# æˆ–è€…åˆ†åˆ«ç¼–è¯‘
cargo build --release --bin server
cargo build --release --bin client
```

### 3. é™æ€ç¼–è¯‘ (MUSL)

ä¸ºäº†ç”Ÿæˆå®Œå…¨é™æ€é“¾æ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `musl` ç›®æ ‡ã€‚è¿™å¯¹äºåˆ›å»ºç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶éå¸¸æœ‰ç”¨ï¼Œæ— éœ€ä¾èµ–ç³»ç»Ÿåº“ã€‚

**å…ˆå†³æ¡ä»¶**:
å®‰è£… `musl` å·¥å…·é“¾ï¼š

```bash
rustup target add x86_64-unknown-linux-musl
```

**ç¼–è¯‘**:

```bash
# ç¼–è¯‘æ‰€æœ‰ç»„ä»¶ä¸ºé™æ€é“¾æ¥
cargo build --release --target x86_64-unknown-linux-musl

# æˆ–è€…åˆ†åˆ«ç¼–è¯‘
cargo build --release --bin server --target x86_64-unknown-linux-musl
cargo build --release --bin client --target x86_64-unknown-linux-musl
```

ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä½äº `target/x86_64-unknown-linux-musl/release/` ç›®å½•ä¸‹ã€‚

### 4. ä½¿ç”¨ UPX å‹ç¼© (å¯é€‰)

UPX (Ultimate Packer for eXecutables) å¯ä»¥è¿›ä¸€æ­¥å‹ç¼©é™æ€é“¾æ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå‡å°å…¶å¤§å°ã€‚

**å…ˆå†³æ¡ä»¶**:
å®‰è£… UPXï¼š

```bash
sudo apt-get install upx
```

**å‹ç¼©**:

```bash
# å‹ç¼©æœåŠ¡ç«¯äºŒè¿›åˆ¶æ–‡ä»¶
upx --best target/x86_64-unknown-linux-musl/release/server

# å‹ç¼©å®¢æˆ·ç«¯äºŒè¿›åˆ¶æ–‡ä»¶
upx --best target/x86_64-unknown-linux-musl/release/client
```

### 5. å¯åŠ¨æœåŠ¡ç«¯

```bash
# å¯åŠ¨æœåŠ¡ç«¯
cargo run --bin server

# æˆ–è€…è¿è¡Œç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶
./target/release/server
```

æœåŠ¡ç«¯å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® `http://localhost:8080` æŸ¥çœ‹Webç®¡ç†ç•Œé¢ã€‚é»˜è®¤ç™»å½•å‡­æ®ä¸º `admin` / `password`ã€‚

### 6. å¯åŠ¨å®¢æˆ·ç«¯

```bash
# è¿æ¥åˆ°æœåŠ¡ç«¯ï¼ˆé»˜è®¤è¿æ¥ http://127.0.0.1:8080ï¼‰
cargo run --bin client

# æˆ–è€…æŒ‡å®šæœåŠ¡ç«¯åœ°å€
cargo run --bin client http://your-server-ip:8080

# æˆ–è€…è¿è¡Œç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶
./target/release/client http://your-server-ip:8080
```

## å¼€å‘æŒ‡å—

### æ¨¡å—åŒ–è®¾è®¡

- **`common`**: åŒ…å«æ‰€æœ‰å…±äº«ä»£ç ï¼Œå¦‚ `message` åè®®ã€`config` ç»“æ„ã€`error` ç±»å‹ã€`crypto` å·¥å…·å’Œ `network` è¾…åŠ©å‡½æ•°ã€‚
- **`server`**: åŒ…å«æ‰€æœ‰æœåŠ¡ç«¯é€»è¾‘ã€‚
  - `main.rs`: ç¨‹åºå…¥å£ï¼Œè®¾ç½®è·¯ç”±å’Œå¯åŠ¨æœåŠ¡å™¨ã€‚
  - `state.rs`: å®šä¹‰å…±äº«çš„ `AppState`ã€‚
  - `managers/`: åŒ…å« `ClientManager` å’Œ `ShellManager`ï¼Œç”¨äºå¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚
  - `handlers/`: åŒ…å« `api.rs` å’Œ `web.rs`ï¼Œåˆ†åˆ«å¤„ç†APIè¯·æ±‚å’ŒWebé¡µé¢æ¸²æŸ“ã€‚
  - `audit.rs`: å®¡è®¡æ—¥å¿—è®°å½•ã€‚
  - `auth.rs`: Webç•Œé¢è®¤è¯ã€‚
- **`client`**: åŒ…å«æ‰€æœ‰å®¢æˆ·ç«¯é€»è¾‘ã€‚

## å…è´£å£°æ˜

âš ï¸ **é‡è¦æé†’**: æœ¬é¡¹ç›®ä»…ç”¨äºæ•™è‚²å’Œç ”ç©¶ç›®çš„ã€‚è¯·å‹¿å°†å…¶ç”¨äºä»»ä½•éæ³•æˆ–æ¶æ„æ´»åŠ¨ã€‚ä½¿ç”¨è€…éœ€è¦æ‰¿æ‹…ä½¿ç”¨æœ¬è½¯ä»¶çš„å…¨éƒ¨è´£ä»»ã€‚
